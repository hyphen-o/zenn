---
title: "jspdfã¨html-to-imageã‚’ä½¿ã£ã¦å‹•çš„ã«PDFã‚’è¤‡æ•°ãƒšãƒ¼ã‚¸ç”Ÿæˆã™ã‚‹"
emoji: "ğŸŒ„"
type: "tech"
topics: ["pdf","react","typescript","jspdf"]
published: true
---

## ã¯ã˜ã‚ã«
å°‘ã—å‰ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³å…ˆã®æ¥­å‹™ã§å‹•çš„ãªPDFç”Ÿæˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸï¼
è¦ä»¶ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ï¼
- APIã®responseã«å¿œã˜ã¦PDFã®ä¸­èº«ã‚’å¤‰ãˆã¦è¤‡æ•°ãƒšãƒ¼ã‚¸ç”Ÿæˆã™ã‚‹
- ç”»åƒã‚„CSSã‚¹ã‚¿ã‚¤ãƒ«ãªã©ã‚’ç››ã‚Šè¾¼ã‚“ã§ã‚‚ï¼Œãƒ‡ã‚¶ã‚¤ãƒ³é€šã‚Šã«ç”Ÿæˆã•ã‚Œã‚‹
- å‡ºæ¥ã‚‹ã ã‘ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯æŠ‘ãˆã‚‹

å‹•çš„ãªPDFã‚’ç”Ÿæˆã™ã‚‹æ–¹æ³•ã¯è¨˜äº‹ã“ãå¤šããªã„ã‚‚ã®ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã„ãã¤ã‹ã‚ã‚Šï¼Œè‰²ã€…è©¦ã—ã¦ã‚¹ã‚¿ã‚¤ãƒ«ãŒå½“ãŸã‚‰ãªã‹ã£ãŸã‚Šã¨ï¼Œå››è‹¦å…«è‹¦ã—ãŸã®ã§ä»Šå›ã¯ãã‚“ãªä¸­ã§ä¸Šè¨˜ã®è¦ä»¶ã‚’æº€ãŸã›ã‚‹ã‹ã¤ï¼Œè‡ªåˆ†ã«ã¨ã£ã¦ä¸€ç•ªã—ã£ãã‚ŠããŸå®Ÿè£…æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã™ï¼

## æ¡ç”¨æŠ€è¡“
ä»Šå›ã¯`jspdf`ã¨`html-to-image`ã‚’ä½¿ç”¨ã—ã¾ã™ï¼
https://github.com/parallax/jsPDF
https://github.com/bubkoo/html-to-image
å‹•çš„ãªPDFã‚’ç”Ÿæˆã™ã‚‹ã¨ãã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å€™è£œã¨ã—ã¦`react-pdf`ã‚„ï¼Œ`jspdf Ã— html2canvas`ã¨ã„ã†é¸æŠè‚¢ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ï¼
ä»Šå›ã“ã‚Œã‚‰ã‚’æ¡ç”¨ã—ãªã‹ã£ãŸç†ç”±ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ï¼

:::details react-pdf
Reactã¨ç›¸æ€§ã¯è‰¯ã„ã§ã™ãŒï¼Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªå´ã§ç”¨æ„ã•ã‚ŒãŸæŒ‡å®šã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç”¨ã„ã‚‹å¿…è¦ãŒã‚ã‚Šï¼Œæ—¢å­˜ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç”¨ã„ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ï¼æ¥­å‹™ã§ã¯æ—¢ã«å®Ÿè£…ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’PDFã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šï¼Œå°å…¥ã‚³ã‚¹ãƒˆãŒé«˜ã‹ã£ãŸãŸã‚æ¡ç”¨ã‚’è¦‹é€ã‚Šã¾ã—ãŸï¼
:::

:::details jspdf Ã— html2canvas
`html-to-image`ã¯`html2canvas`ã‚’å†…åŒ…ã—ã¦ã„ã‚‹ãŸã‚ï¼Œã§ãã‚‹ã“ã¨ï¼Œã‚„ã‚‹ã“ã¨ã«å¤§ã—ãŸé•ã„ã¯ã‚ã‚Šã¾ã›ã‚“ãŒï¼Œ`html-to-image`ã®æ–¹ãŒã‚ˆã‚Šç°¡æ˜“çš„ã«å®Ÿè£…ã§ãã¾ã™ï¼ã¾ãŸï¼Œ`html2canvas`ã¯ä»Šå›ã®å®Ÿè£…ã«å¿…è¦ãªCSSãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå¯¾å¿œã—ã¦ã„ãªã„ãªã©ã®å•é¡Œç‚¹ãŒã‚ã£ãŸãŸã‚ï¼Œæ¡ç”¨ã‚’è¦‹é€ã‚Šã¾ã—ãŸï¼
https://github.com/niklasvh/html2canvas/issues/1258
:::

## å®Ÿè£…æ–¹æ³•
### PDFç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
ã¾ãšã¯ï¼ŒPDFç”Ÿæˆã®å¯¾è±¡ã¨ãªã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ã„ãã¾ã™ï¼
```ts:components/container-pdf.tsx
export const ContainerPdf = ({ children }: ContainerPdfProps) => {
  return (
    <div
      style={{
        width: "595px",
        height: "842px",
        border: "solid",
      }}
    >
      {children}
    </div>
  );
};
```

```ts:pages/index.tsx
import { ContainerPdf } from "@/components/container";

const Index = () => {
  return (
    <div
      style={{
        display: "flex",
        padding: "20px",
      }}
    >
      <div
        style={{
          display: "flex",
          gap: "10px",
        }}
      >
        <ContainerPdf>
          <h1>sample dynamic-PDF </h1>
          <p>This is sample for generating PDF!</p>
        </ContainerPdf>
        <ContainerPdf>
          <p>This is page 2</p>
        </ContainerPdf>
      </div>
      <button
        onClick={}
        style={{
          width: "200px",
          height: "50px",
        }}
      >
        generate pdf
      </button>
    </div>
  );
};

export default Index;

```

#### ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
![ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼](/images/dynamic-pdf/preview.png)

`ContainerPdf`ã§å›²ã¾ã‚ŒãŸéƒ¨åˆ†ï¼ˆé»’æ ã§å›²ã‚ã‚ŒãŸéƒ¨åˆ†ï¼‰ãŒPDFåŒ–ã®å¯¾è±¡ã¨ãªã£ã¦ãŠã‚Šï¼ŒA4ç¸¦ã‚µã‚¤ã‚ºã§æŒ‡å®šã—ã¦ã„ã¾ã™ï¼æ¯”ç‡ãŒåŒã˜ã§ã‚ã‚Œã°ã‚µã‚¤ã‚ºã¯å¤‰æ›´ã—ã¦ã‚‚å•é¡Œãªã„ã§ã™ï¼

### PDFç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯

```ts:hooks/use-pdf.ts
import { useRef } from "react";
import { toJpeg } from "html-to-image";
import jsPDF from "jspdf";

export const usePdf = () => {
  const targetRef = useRef<HTMLDivElement>(null);

  //PDFç”Ÿæˆ
  const generatePdf = async () => {
    if(!targetRef.current) return
    
    const pdf = new jsPDF("p", "px", [595, 842]);

    //PDFã®é«˜ã•ã¨æ¨ªå¹…ã‚’å–å¾—
    const width = pdf.internal.pageSize.getWidth();
    const height = pdf.internal.pageSize.getHeight();
    
    //ãƒšãƒ¼ã‚¸ã”ã¨ã®Elementã‚’é…åˆ—ã«æ ¼ç´
    const childElements = Array.from(targetRef.current.children);

    //ãƒšãƒ¼ã‚¸ã”ã¨ã«PDFç”Ÿæˆ
    for (const childElement of childElements) {
      const dataUrl = await toJpeg(childElement as HTMLElement, { backgroundColor: "white" });
      pdf.addImage(dataUrl, "PNG", 0, 0, width, height);
      pdf.addPage();
    }

    //æœ€å¾Œã®ç™½ç´™ãƒšãƒ¼ã‚¸ã‚’å‰Šé™¤
    pdf.deletePage(pdf.getNumberOfPages());

    //Blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
    const pdfBytes = pdf.output("arraybuffer");
    const pdfBlob = new Blob([pdfBytes], { type: "application/pdf" });

    //URLã‚’ç”Ÿæˆ
    const fileUrl = URL.createObjectURL(pdfBlob);
    window.open(fileUrl);
  };

  return { targetRef, generatePdf };
};
```
ã‚³ãƒ¡ãƒ³ãƒˆã‚‚æ›¸ã„ã¦ã„ã¾ã™ãŒï¼Œãã‚Œãã‚Œè©³ã—ãè§£èª¬ã—ã¦ã„ãã¾ã™ï¼


```ts
const pdf = new jsPDF("p", "px", [595, 842]);
```
jsPDFã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ï¼ç”Ÿæˆæ™‚ã«å‘ãã‚„ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãï¼Œä»Šå›ã¯ç¸¦å‘ãï¼ŒA4ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ï¼ãã®ä»–ã®optionã¯ä¸‹è¨˜ã®Doumentã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼
https://artskydj.github.io/jsPDF/docs/jsPDF.html

```ts
const targetRef = useRef<HTMLDivElement>(null);
```
PDFåŒ–ã®å¯¾è±¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¦ªElementã‚’å¾—ã‚‹ãŸã‚ã«Refã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ãŠãã¾ã™ï¼

```ts
const childElements = Array.from(targetRef.current.children);
```
å„ãƒšãƒ¼ã‚¸ã®Elementã‚’å–å¾—ã—ã¦ãã¦é…åˆ—ã«ã—ã¾ã™ï¼

```ts
for (const childElement of childElements) {
  const dataUrl = await toJpeg(childElement as HTMLElement, { backgroundColor: "white" });
  pdf.addImage(dataUrl, "JPEG", 0, 0, width, height);
  pdf.addPage();
}

//æœ€å¾Œã®ç™½ç´™ãƒšãƒ¼ã‚¸ã‚’å‰Šé™¤
pdf.deletePage(pdf.getNumberOfPages());
```
å„ãƒšãƒ¼ã‚¸ã®Elementã‚’`html-to-image`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®`toJpeg`é–¢æ•°ã‚’ä½¿ã£ã¦ç”»åƒã«å¤‰æ›ã—ï¼Œpdfã«è¿½åŠ ã—ã¦ã„ã¾ã™ï¼ä»Šå›ã¯`toJpeg`é–¢æ•°ã‚’ç”¨ã„ã¦ã„ã¾ã™ãŒï¼Œä»–ã«ã‚‚`toPng`ã‚„`toSvg`ãªã©ã‚’ä½¿ã†ã¨ã•ã¾ã–ã¾ãªå½¢å¼ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ä»¥å‰ã¯pngã«å¤‰æ›ã—ã¦ä½¿ã£ã¦ã„ãŸã®ã§ã™ãŒï¼Œç”Ÿæˆæ™‚é–“ãŒéå¸¸ã«é•·ãï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚‚å¤§ãããªã£ã¦ã—ã¾ã£ãŸãŸã‚ï¼Œjpegã«ä¹—ã‚Šæ›ãˆã¾ã—ãŸï¼è§£åƒåº¦ã¯pngã‚ˆã‚Šã‚„ã‚„è½ã¡ã¾ã™ãŒï¼Œç›®ç«‹ãŸãªã„ãƒ¬ãƒ™ãƒ«ã ã¨æ€ã„ã¾ã™ï¼
:::details ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®æ¯”è¼ƒ
10ãƒšãƒ¼ã‚¸ã®PDFã‚’ç”Ÿæˆã—ãŸå ´åˆï¼ˆã‚¹ã‚¿ã‚¤ãƒ«ãªã©ã«ã‚ˆã‚Šå·®ãŒå‡ºã‚‹å¯èƒ½æ€§ã‚ã‚Šï¼‰
`toPng`ï¼š120MB
`toJpeg`ï¼š4.3MB
:::
ã‚‚ã—ã•ã‚‰ã«è§£åƒåº¦ã‚’ä¸Šã’ãŸã„æ–¹ã¯`components/container.tsx`ã§æŒ‡å®šã—ã¦ã„ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚µã‚¤ã‚ºã‚’æ¯”ç‡ã‚’å¤‰ãˆãšã«å¤§ããã™ã‚‹ã“ã¨ã§å¯èƒ½ã§ã™ï¼

ã¾ãŸï¼Œ`html-to-image`ãŒæä¾›ã—ã¦ã„ã‚‹é–¢æ•°ã«ã¯ã„ãã¤ã‹optionãŒã‚ã‚Šã¾ã™ï¼ä»Šå›ã¯`backgroundColor`ã¨ã„ã†optionã‚’ä½¿ã£ã¦èƒŒæ™¯è‰²ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ï¼
ã‚‚ã—ã•ã‚‰ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’å°ã•ãã—ãŸã„ã¨ã„ã†æ–¹ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«qualityã¨ã„ã†optionã‚’æŒ‡å®šã™ã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ï¼è§£åƒåº¦ã¨ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ãªãŸã‚ï¼Œæ³¨æ„ãŒå¿…è¦ã§ã™ï¼
```ts
const dataUrl = await toJpeg(childElement as HTMLElement, { 
  backgroundColor: "white",
  quality: 0.8 //ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1
});
```
ãã®ä»–ã®optionã¯ä¸‹è¨˜ã®å…¬å¼READMEã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼
https://github.com/bubkoo/html-to-image/pkgs/npm/html-to-image

```ts
//Blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
const pdfBytes = pdf.output("arraybuffer");
const pdfBlob = new Blob([pdfBytes], { type: "application/pdf" });

//URLã‚’ç”Ÿæˆ
const fileUrl = URL.createObjectURL(pdfBlob);
window.open(fileUrl);
```
PDFãŒä½œæˆã§ããŸã®ã§ï¼ŒBlobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¦URLã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ï¼ä»Šå›ã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ã—ã¦åˆ¥ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã§PDFã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ï¼Blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ç”Ÿæˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼

```diff ts:pages/index.tsx
import { ContainerPdf } from "@/components/container";
import { usePdf } from "@/hooks";

const Index = () => {
+ const { targetRef, generatePdf } = usePdf();

  return (
    <div
      style={{
        display: "flex",
        padding: "20px",
      }}
    >
      <div
        style={{
          display: "flex",
          gap: "10px",
        }}
+       ref={targetRef}
      >
        <ContainerPdf>
          <h1>sample dynamic-PDF </h1>
          <p>This is sample for generating PDF!</p>
        </ContainerPdf>
        <ContainerPdf>
          <p>This is page 2</p>
        </ContainerPdf>
      </div>
      <button
+       onClick={generatePdf}
        style={{
          width: "200px",
          height: "50px",
        }}
      >
        generate pdf
      </button>
    </div>
  );
};

export default Index;

```
æœ€å¾Œã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¹‹ãè¾¼ã‚“ã§çµ‚äº†ã§ã™ï¼
ä¸‹ç”»åƒã®ã‚ˆã†ãªå‡ºåŠ›çµæœã«ãªã‚Šã¾ã—ãŸï¼
![ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼](/images/dynamic-pdf/pdf-preview.png)

## ã‚ã¨ãŒã

åˆã‚ã¦ã®è¨˜äº‹åŸ·ç­†ã®ãŸã‚ï¼Œæ‹™ã„æ–‡ç« ã ã£ãŸã¨æ€ã„ã¾ã™ãŒæœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

æœ¬è¨˜äº‹ã§åˆ©ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚Šã¾ã™ï¼
https://github.com/hyphen-o/dynamic-pdf
